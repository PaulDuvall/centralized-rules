name: Reusable ShellCheck Workflow

on:
  workflow_call:
    inputs:
      scan-dir:
        description: 'Directory to scan for shell scripts'
        required: true
        type: string
      severity:
        description: 'Minimum severity level (error, warning, info, style)'
        required: false
        type: string
        default: 'warning'
      format:
        description: 'Output format (gcc, checkstyle, diff, json, tty)'
        required: false
        type: string
        default: 'gcc'

jobs:
  shellcheck:
    name: ShellCheck (${{ inputs.scan-dir }})
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run ShellCheck
        id: shellcheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: ${{ inputs.scan-dir }}
          severity: ${{ inputs.severity }}
          format: ${{ inputs.format }}
        continue-on-error: true

      - name: Generate ShellCheck summary
        if: always()
        run: |
          # Source summary utilities
          # shellcheck source=scripts/ci/summary-utils.sh
          source scripts/ci/summary-utils.sh

          # Generate summary
          summary_header "üîç ShellCheck Results: ${{ inputs.scan-dir }}" "${{ steps.shellcheck.outcome }}"
          summary_config \
            "Scan Directory: \`${{ inputs.scan-dir }}\`" \
            "Severity Level: ${{ inputs.severity }}" \
            "Format: ${{ inputs.format }}"
          summary_footer

      - name: Fail if issues found
        if: steps.shellcheck.outcome != 'success'
        run: exit 1
